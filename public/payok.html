<!DOCTYPE html>
<html lang="zh-CN" class="weui-msg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>支付结果</title>
    <link href="/assets/css/weui.min.css" rel="stylesheet">
    <style>.page {position: absolute;top: 0;right: 0;bottom: 0;left: 0;overflow-y: auto;box-sizing: border-box;}</style>
</head>
<body>
<div class="container">
    <div class="page">
        <div class="weui-msg">
            <div class="weui-msg__icon-area">
                <i class="weui-icon-success weui-icon_msg"></i>
            </div>
            <div class="weui-msg__text-area">
                <h2 class="weui-msg__title">支付成功</h2>
                <p class="weui-msg__desc">支付成功，请回到网站查看订单</p>
            </div>
            <div class="weui-msg__opr-area">
                <p class="weui-btn-area">
                    <a href="javascript:;" class="weui-btn weui-btn_primary" onclick="alert('请回到网站查看订单！')">确定</a>
                    <a href="javascript:;" class="weui-btn weui-btn_default" id="Close">关闭</a>
                </p>
            </div>
        </div>
    </div>
</div>
<script>
    function setupCloseButton() {
        const closeBtn = document.getElementById('Close');
        if (!closeBtn) return;

        // 防止重复绑定
        if (closeBtn.dataset.bound) return;
        closeBtn.dataset.bound = 'true';

        const ua = navigator.userAgent;

        // 支付宝
        if (ua.includes('AlipayClient/')) {
            const handleAlipayClose = () => {
                if (window.AlipayJSBridge) {
                    AlipayJSBridge.call('popWindow');
                }
            };

            if (window.AlipayJSBridge) {
                closeBtn.addEventListener('click', handleAlipayClose);
            } else {
                document.addEventListener('AlipayJSBridgeReady', () => {
                    closeBtn.addEventListener('click', handleAlipayClose);
                }, { once: true });
            }
        }
        // 微信
        else if (ua.includes('MicroMessenger/')) {
            const handleWechatClose = () => {
                if (typeof WeixinJSBridge !== 'undefined') {
                    WeixinJSBridge.call('closeWindow');
                }
            };

            if (typeof WeixinJSBridge !== 'undefined') {
                closeBtn.addEventListener('click', handleWechatClose);
            } else {
                document.addEventListener('WeixinJSBridgeReady', () => {
                    closeBtn.addEventListener('click', handleWechatClose);
                }, { once: true });
            }
        }
        // QQ 浏览器：隐藏按钮（需用户手动关闭）
        else if (ua.includes('QQ/')) {
            closeBtn.style.display = 'none';
        }
        // 普通浏览器
        else {
            closeBtn.addEventListener('click', () => {
                window.opener = null;
                window.close();
            });
        }
    }

    // 等待 DOM 加载完成后初始化
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupCloseButton);
    } else {
        setupCloseButton();
    }

    // 禁止页面滚动
    document.body.addEventListener('touchmove', (e) => {
        e.preventDefault();
    }, { passive: false });
</script>
</body>
</html>
