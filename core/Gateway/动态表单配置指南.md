# 动态表单配置指南

## 概述

通过在支付网关插件配置 config 参数，您可以轻松生成功能丰富的表单界面（基于 Vue 3 和 Element Plus 构建）。

## 配置结构

在支付网关插件中，通过 `$info['config']` 数组定义表单控件，`$info['config']` 是一个多维数组，每个数组元素代表一个表单项配置：

```php
public static array $info = [
    // ... 其他配置
    'config' => [
        [
            "field"       => "字段名",
            "type"        => "控件类型",
            "label"       => "显示标签",
            // ... 其他配置项
        ],
        // 更多表单项配置...
    ]
];
```

## 配置项详细说明

### 必需配置项

| 配置项     | 类型     | 说明            | 示例         |
|---------|--------|---------------|------------|
| `field` | string | 字段名，用于数据绑定和验证 | `"app_id"` |
| `type`  | string | 控件类型，见下方支持的类型 | `"input"`  |
| `label` | string | 表单项显示标签       | `"应用ID"`   |

### 可选配置项

| 配置项            | 类型      | 说明                          | 默认值      | 示例                      |
|----------------|---------|-----------------------------|----------|-------------------------|
| `placeholder`  | string  | 输入提示文本                      | -        | `"请输入支付宝AppID"`         |
| `required`     | boolean | 是否必填                        | `false`  | `true`                  |
| `disabled`     | boolean | 是否禁用                        | `false`  | `true`                  |
| `readonly`     | boolean | 是否只读                        | `false`  | `true`                  |
| `maxlength`    | integer | 最大字符长度（仅text类型）             | -        | `32`                    |
| `min`          | number  | 最小值（仅number类型）              | -        | `0`                     |
| `max`          | number  | 最大值（仅number类型）              | -        | `100`                   |
| `step`         | number  | 步长（仅number类型）               | `1`      | `0.1`                   |
| `precision`    | integer | 小数位数（仅number类型）             | -        | `2`                     |
| `multiple`     | boolean | 是否多选（仅select类型）             | `false`  | `true`                  |
| `defaultValue` | mixed   | 默认值                         | 根据类型自动设置 | `""`, `[]`, `false`     |
| `span`         | integer | 栅格占用列数（1-24）                | `24`     | `12`                    |
| `tooltip`      | string  | 工具提示文本                      | -        | `"可选项，如未设置则不需要填写"`      |
| `options`      | array   | 选项列表（select/radio/checkbox） | -        | 见下方示例                   |
| `rules`        | array   | 自定义验证规则                     | -        | 见下方示例                   |
| `props`        | array   | 额外属性                        | -        | `["clearable" => true]` |
| `style`        | array   | 内联样式                        | -        | `["width" => "200px"]`  |
| `class`        | string  | CSS类名                       | -        | `"custom-input"`        |

## 支持的控件类型

### 1. 文本输入类

#### input - 单行文本输入

```php
[
    "field"       => "app_id",
    "type"        => "input",
    "label"       => "应用ID",
    "placeholder" => "请输入应用ID",
    "required"    => true,
    "maxlength"   => 32
]
```

#### textarea - 多行文本输入

```php
[
    "field"       => "description",
    "type"        => "textarea",
    "label"       => "描述信息",
    "placeholder" => "请输入描述信息",
    "maxlength"   => 500,
    "span"        => 24
]
```

#### password - 密码输入

```php
[
    "field"       => "secret_key",
    "type"        => "password",
    "label"       => "密钥",
    "placeholder" => "请输入密钥",
    "required"    => true,
    "maxlength"   => 64
]
```

### 2. 数字输入类

#### number - 数字输入

```php
[
    "field"     => "timeout",
    "type"      => "number",
    "label"     => "超时时间",
    "min"       => 1,
    "max"       => 300,
    "step"      => 1,
    "precision" => 0,
    "required"  => true
]
```

### 3. 选择类

#### select - 下拉选择

```php
[
    "field"    => "environment",
    "type"     => "select",
    "label"    => "环境选择",
    "required" => true,
    "options"  => [
        ["label" => "生产环境", "value" => "production"],
        ["label" => "测试环境", "value" => "test"],
        ["label" => "开发环境", "value" => "development"]
    ]
]
```

#### select - 多选下拉

```php
[
    "field"    => "permissions",
    "type"     => "select",
    "label"    => "权限选择",
    "multiple" => true,
    "options"  => [
        ["label" => "读取", "value" => "read"],
        ["label" => "写入", "value" => "write"],
        ["label" => "删除", "value" => "delete"]
    ]
]
```

#### radio - 单选按钮组

```php
[
    "field"   => "status",
    "type"    => "radio",
    "label"   => "状态",
    "options" => [
        ["label" => "启用", "value" => 1],
        ["label" => "禁用", "value" => 0]
    ]
]
```

#### checkbox - 复选框组

```php
[
    "field"        => "payment_types",
    "type"         => "checkbox",
    "label"        => "支付类型",
    "required"     => true,
    "options"      => [
        ["label" => "当面付", "value" => "dmf"],
        ["label" => "订单码支付", "value" => "ddm"],
        ["label" => "APP支付", "value" => "app"],
        ["label" => "手机网站支付", "value" => "wap"],
        ["label" => "电脑网站支付", "value" => "pc"]
    ],
    "defaultValue" => ["wap", "pc"]
]
```

### 4. 开关类

#### switch - 开关

```php
[
    "field"   => "sandbox_mode",
    "type"    => "switch",
    "label"   => "沙箱模式",
    "tooltip" => "开启后将使用沙箱环境进行测试"
]
```

### 5. 日期时间类

#### date - 日期选择

```php
[
    "field"       => "expire_date",
    "type"        => "date",
    "label"       => "过期日期",
    "placeholder" => "请选择过期日期"
]
```

#### datetime - 日期时间选择

```php
[
    "field"       => "created_at",
    "type"        => "datetime",
    "label"       => "创建时间",
    "placeholder" => "请选择创建时间"
]
```

#### time - 时间选择

```php
[
    "field"       => "notify_time",
    "type"        => "time",
    "label"       => "通知时间",
    "placeholder" => "请选择通知时间"
]
```

## 选项配置（options）

对于 `select`、`radio`、`checkbox` 类型，需要配置 `options` 数组：

```php
"options" => [
    [
        "label"    => "显示文本",
        "value"    => "实际值",
        "disabled" => false  // 可选，是否禁用此选项
    ],
    // 更多选项...
]
```

## 自定义验证规则（rules）

可以添加自定义验证规则：

```php
[
    "field" => "email",
    "type"  => "input",
    "label" => "邮箱地址",
    "rules" => [
        [
            "type"    => "email",
            "message" => "请输入正确的邮箱地址",
            "trigger" => "blur"
        ]
    ]
]
```

## 布局配置

### 栅格布局（span）

使用 `span` 属性控制表单项占用的列数（1-24）：

```php
[
    "field" => "title",
    "type"  => "input",
    "label" => "标题",
    "span"  => 12  // 占用一半宽度
]
```

### 工具提示（tooltip）

为表单项添加说明提示：

```php
[
    "field"   => "aes_key",
    "type"    => "input",
    "label"   => "AES密钥",
    "tooltip" => "可选项，如未在开放平台设置，则不需要填写"
]
```

## 完整示例

以下是一个完整的支付网关配置示例：

```php
<?php

namespace Core\Gateway\Alipay;

class Alipay
{
    public static array $info = [
        'name'        => 'Alipay',
        'title'       => '支付宝支付',
        'author'      => 'KKPay',
        'version'     => '1.0.0',
        'description' => '支付宝支付网关插件',
        'config'      => [
            // 文本输入
            [
                "field"       => "app_id",
                "type"        => "input",
                "label"       => "AppID",
                "placeholder" => "请输入支付宝AppID",
                "required"    => true
            ],
            // 多行文本
            [
                "field"       => "private_key",
                "type"        => "textarea",
                "label"       => "应用私钥",
                "span"        => 24,
                "required"    => true
            ],
            // 复选框组
            [
                'field'        => 'payment_types',
                'type'         => 'checkbox',
                'label'        => '支付类型',
                'options'      => [
                    ['label' => '当面付', 'value' => 'dmf'],
                    ['label' => '手机支付', 'value' => 'wap']
                ],
                'defaultValue' => ['wap']
            ],
            // 开关
            [
                'field'   => 'sandbox_mode',
                'type'    => 'switch',
                'label'   => '沙箱模式',
                'tooltip' => '开启后将使用支付宝沙箱环境'
            ]
        ]
    ];
}
```

## 最佳实践

1. **字段命名**：`field` 必须是唯一的，建议使用下划线命名法
2. **必填验证**：设置 `required => true` 会自动添加必填验证
3. **数据类型**：确保 `defaultValue` 的类型与控件类型匹配
4. **选项配置**：`options` 中的 `value` 可以是字符串、数字或布尔值
5. **布局响应**：`span` 配置在移动端会自动调整为全宽显示
6. **工具提示**：`tooltip` 会在标签旁显示问号图标，鼠标悬停显示提示内容

## 常见问题

### Q: 如何设置表单项为只读？

A: 使用 `readonly => true` 或 `disabled => true`

### Q: 如何实现条件显示？

A: 目前组件不支持条件显示，需要在 PHP 端根据条件动态生成配置

### Q: 如何自定义验证规则？

A: 使用 `rules` 配置项添加 Element Plus 支持的验证规则

### Q: 如何设置多列布局？

A: 使用 `span` 配置项，24列栅格系统，例如 `span => 12` 表示占用一半宽度
